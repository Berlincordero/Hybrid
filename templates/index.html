{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}
{% trans "Inicio" %} - Mi Red Social
{% endblock %}

{% block content %}
<!-- Header principal -->
<div class="bg-gray-800 p-6 rounded-lg shadow mx-auto max-w-4xl mt-4">
  <div class="flex items-center justify-start space-x-3">
    <!-- Ícono/foto -->
    <img
      src="{% if perfil and perfil.foto_perfil %}{{ perfil.foto_perfil.url }}{% else %}{% static 'img/vacio.png' %}{% endif %}"
      alt="{% trans 'User Avatar' %}"
      class="w-14 h-14 rounded-full border-2 border-white object-cover"
    />
    
    <a href="{% url 'foro_list' %}">
      <button class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2
                     rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
        Ir a mi Foro
      </button>
    </a>
  </div>
</div>

<!-- Contenedor principal -->
<div class="container mx-auto px-4 py-6">
  <main class="space-y-6">

    <!-- 1) CARGA INICIAL de foros via context processor -->
    <div id="feed-container">
      {% include '_foro_cards.html' with foros=foros_context comentario_form=comentario_form_context %}
    </div>

 

  </main>
</div>
{% endblock %}

{% block extra_scripts %}
{{ block.super }}

<script>
document.addEventListener('DOMContentLoaded', function() {
  // URL que devolverá el HTML parcial (en JSON) para refrescar
  const feedUrl = "{% url 'foro_feed' %}";
  const feedContainer = document.getElementById('feed-container');

  function refreshFeed() {
    fetch(feedUrl)
      .then(response => response.json())
      .then(data => {
        // Reemplaza el contenido con el nuevo HTML
        feedContainer.innerHTML = data.html;
      })
      .catch(error => {
        console.error("Error al refrescar el feed:", error);
      });
  }

  // Cada 30 segundos, refrescamos la lista de foros
  setInterval(refreshFeed, 30000);
});
</script>
{% endblock %}
